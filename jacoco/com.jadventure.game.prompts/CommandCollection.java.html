<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CommandCollection.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Java Text Adventure</a> &gt; <a href="index.source.html" class="el_package">com.jadventure.game.prompts</a> &gt; <span class="el_source">CommandCollection.java</span></div><h1>CommandCollection.java</h1><pre class="source lang-java linenums">package com.jadventure.game.prompts;

import java.lang.reflect.Method;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Random;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.jadventure.game.DeathException;
import com.jadventure.game.QueueProvider;
import com.jadventure.game.conversation.ConversationManager;
import com.jadventure.game.entities.Player;
import com.jadventure.game.entities.NPC;
import com.jadventure.game.monsters.Monster;
import com.jadventure.game.monsters.MonsterFactory;
import com.jadventure.game.navigation.Coordinate;
import com.jadventure.game.navigation.Direction;
import com.jadventure.game.navigation.ILocation;
import com.jadventure.game.navigation.LocationType;
import com.jadventure.game.repository.ItemRepository;
import com.jadventure.game.repository.LocationRepository;
import com.jadventure.game.DeathException;
import com.jadventure.game.GameBeans;

/**
 * CommandCollection contains the declaration of the methods mapped to game commands
 *
 * The declared command methods are accessed only by reflection.
 * To declare a new command, add an appropriate method to this class and Annotate it with
 * Command(command, aliases, description)
 */
<span class="nc" id="L35">public enum CommandCollection {</span>
<span class="nc" id="L36">    INSTANCE;</span>

<span class="nc" id="L38">    private Logger logger = LoggerFactory.getLogger(CommandCollection.class);</span>

    public Player player;

<span class="nc" id="L42">    private final static Map&lt;String, String&gt; DIRECTION_LINKS = new HashMap&lt;String,String&gt;();</span>
    static {
<span class="nc" id="L44">        DIRECTION_LINKS.put(&quot;n&quot;, &quot;north&quot;);</span>
<span class="nc" id="L45">        DIRECTION_LINKS.put(&quot;s&quot;, &quot;south&quot;);</span>
<span class="nc" id="L46">        DIRECTION_LINKS.put(&quot;e&quot;, &quot;east&quot;);</span>
<span class="nc" id="L47">        DIRECTION_LINKS.put(&quot;w&quot;, &quot;west&quot;);</span>
<span class="nc" id="L48">        DIRECTION_LINKS.put(&quot;u&quot;, &quot;up&quot;);</span>
<span class="nc" id="L49">        DIRECTION_LINKS.put(&quot;d&quot;, &quot;down&quot;);</span>
<span class="nc" id="L50">    }</span>

    public static CommandCollection getInstance() {
<span class="nc" id="L53">        return INSTANCE;</span>
    }

    public void initPlayer(Player player) {
<span class="nc" id="L57">        this.player = player;</span>
<span class="nc" id="L58">    }</span>

    // command methods here

    @Command(command=&quot;help&quot;, aliases=&quot;h&quot;, description=&quot;Prints help&quot;, debug=false)
    public void command_help() {
<span class="nc" id="L64">        Method[] methods = CommandCollection.class.getMethods();</span>
<span class="nc" id="L65">        int commandWidth = 0;</span>
<span class="nc" id="L66">        int descriptionWidth = 0;</span>
<span class="nc" id="L67">        QueueProvider.offer(&quot;&quot;);</span>
<span class="nc bnc" id="L68" title="All 2 branches missed.">        for (Method method : methods) {</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">            if (!method.isAnnotationPresent(Command.class)) {</span>
<span class="nc" id="L70">                continue;</span>
            }
<span class="nc" id="L72">            Command annotation = method.getAnnotation(Command.class);</span>
<span class="nc" id="L73">            String command = annotation.command() + &quot;( &quot; + annotation.aliases() + &quot;):&quot;;</span>
<span class="nc" id="L74">            String description = annotation.description();</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">            if (command.length() &gt; commandWidth) {</span>
<span class="nc" id="L76">                commandWidth = command.length();</span>
            }
<span class="nc bnc" id="L78" title="All 2 branches missed.">            if (description.length() &gt; descriptionWidth) {</span>
<span class="nc" id="L79">                descriptionWidth = description.length();</span>
            }
        }
<span class="nc bnc" id="L82" title="All 2 branches missed.">        for (Method method : methods) {</span>
<span class="nc bnc" id="L83" title="All 2 branches missed.">            if (!method.isAnnotationPresent(Command.class)) {</span>
<span class="nc" id="L84">                continue;</span>
            }
<span class="nc" id="L86">            Command annotation = method.getAnnotation(Command.class);</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">            String command = (annotation.aliases().length() == 0) ? </span>
<span class="nc" id="L88">                annotation.command() : annotation.command() + &quot; (&quot; + annotation.aliases() + &quot;):&quot;; </span>
<span class="nc" id="L89">            String message = String.format(&quot;%-&quot; +commandWidth + &quot;s %-&quot; + descriptionWidth + &quot;s&quot;, </span>
                    command, 
<span class="nc" id="L91">                    annotation.description());</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">            if (annotation.debug()) {</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">                if (&quot;test&quot;.equals(player.getName())) {</span>
<span class="nc" id="L94">                    QueueProvider.offer(message);</span>
                }
            } else {
<span class="nc" id="L97">                QueueProvider.offer(message);</span>
                
            }
        }
<span class="nc" id="L101">    }</span>

    @Command(command=&quot;save&quot;, aliases=&quot;s&quot;, description=&quot;Save the game&quot;, debug=false)
    public void command_save() {
<span class="nc" id="L105">        logger.info(&quot;Command 'save' is running&quot;);</span>
<span class="nc" id="L106">        player.save();</span>
<span class="nc" id="L107">    }</span>

    @Command(command=&quot;monster&quot;, aliases=&quot;m&quot;, description=&quot;Monsters around you&quot;, debug=false)
    public void command_m() {
<span class="nc" id="L111">        List&lt;Monster&gt; monsterList = player.getLocation().getMonsters();</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">        if (monsterList.size() &gt; 0) {</span>
<span class="nc" id="L113">            QueueProvider.offer(&quot;Monsters around you:&quot;);</span>
<span class="nc" id="L114">            QueueProvider.offer(&quot;----------------------------&quot;);</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">            for (Monster monster : monsterList) {</span>
<span class="nc" id="L116">                QueueProvider.offer(monster.monsterType);</span>
<span class="nc" id="L117">            }</span>
<span class="nc" id="L118">            QueueProvider.offer(&quot;----------------------------&quot;);</span>
        } else {
<span class="nc" id="L120">            QueueProvider.offer(&quot;There are no monsters around you'n&quot;);</span>
        }
<span class="nc" id="L122">    }</span>

    @Command(command=&quot;go&quot;, aliases=&quot;g&quot;, description=&quot;Goto a direction&quot;, debug=false)
    public void command_g(String arg) throws DeathException {
<span class="nc" id="L126">        ILocation location = player.getLocation();</span>

        try {
<span class="nc" id="L129">            arg = DIRECTION_LINKS.get(arg);</span>
<span class="nc" id="L130">            Direction direction = Direction.valueOf(arg.toUpperCase());</span>
<span class="nc" id="L131">            Map&lt;Direction, ILocation&gt; exits = location.getExits();</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">            if (exits.containsKey(direction)) {</span>
<span class="nc" id="L133">                ILocation newLocation = exits.get(Direction.valueOf(arg.toUpperCase()));</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">                if (!newLocation.getLocationType().equals(LocationType.WALL)) {</span>
<span class="nc" id="L135">                    player.setLocation(newLocation);</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">                    if (&quot;test&quot;.equals(player.getName())) {</span>
<span class="nc" id="L137">                        QueueProvider.offer(player.getLocation().getCoordinate().toString());</span>
                    }
<span class="nc" id="L139">                    player.getLocation().print();</span>
<span class="nc" id="L140">                    Random random = new Random();</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">                    if (player.getLocation().getMonsters().size() == 0) {</span>
<span class="nc" id="L142">                        MonsterFactory monsterFactory = new MonsterFactory();</span>
<span class="nc" id="L143">                        int upperBound = random.nextInt(player.getLocation().getDangerRating() + 1);</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">                        for (int i = 0; i &lt; upperBound; i++) {</span>
<span class="nc" id="L145">                            Monster monster = monsterFactory.generateMonster(player);</span>
<span class="nc" id="L146">                            player.getLocation().addMonster(monster);</span>
                        }
                    }
<span class="nc bnc" id="L149" title="All 2 branches missed.">                    if (player.getLocation().getItems().size() == 0) {</span>
<span class="nc" id="L150">                        int chance = random.nextInt(100);</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">                        if (chance &lt; 60) {</span>
<span class="nc" id="L152">                            addItemToLocation();</span>
                        }
                    }
<span class="nc bnc" id="L155" title="All 2 branches missed.">                    if (random.nextDouble() &lt; 0.5) {</span>
<span class="nc" id="L156">                        List&lt;Monster&gt; monsters = player.getLocation().getMonsters();</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">                        if (monsters.size() &gt; 0) {</span>
<span class="nc" id="L158">                            int posMonster = random.nextInt(monsters.size());</span>
<span class="nc" id="L159">                            String monster = monsters.get(posMonster).monsterType;</span>
<span class="nc" id="L160">                            QueueProvider.offer(&quot;A &quot; + monster + &quot; is attacking you!&quot;);</span>
<span class="nc" id="L161">                            player.attack(monster);</span>
                        }
                    }
<span class="nc" id="L164">                } else {</span>
<span class="nc" id="L165">                    QueueProvider.offer(&quot;You cannot walk through walls.&quot;);</span>
                }
<span class="nc" id="L167">            } else {</span>
<span class="nc" id="L168">                QueueProvider.offer(&quot;The is no exit that way.&quot;);</span>
            }
<span class="nc" id="L170">        } catch (IllegalArgumentException ex) {</span>
<span class="nc" id="L171">            QueueProvider.offer(&quot;That direction doesn't exist&quot;);</span>
<span class="nc" id="L172">        } catch (NullPointerException ex) {</span>
<span class="nc" id="L173">            QueueProvider.offer(&quot;That direction doesn't exist&quot;);</span>
<span class="nc" id="L174">        }</span>
<span class="nc" id="L175">    }</span>

    @Command(command=&quot;inspect&quot;, aliases=&quot;i&quot;, description=&quot;Inspect an item&quot;, debug=false)
    public void command_i(String arg) {
<span class="nc" id="L179">        player.inspectItem(arg.trim());</span>
<span class="nc" id="L180">    }</span>

    @Command(command=&quot;equip&quot;, aliases=&quot;e&quot;, description=&quot;Equip an item&quot;, debug=false)
    public void command_e(String arg) {
<span class="nc" id="L184">        player.equipItem(arg.trim());</span>
<span class="nc" id="L185">    }</span>

    @Command(command=&quot;unequip&quot;, aliases=&quot;ue&quot;, description=&quot;Unequip an item&quot;, debug=false)
    public void command_ue(String arg) {
<span class="nc" id="L189">        player.dequipItem(arg.trim());</span>
<span class="nc" id="L190">    }</span>

    @Command(command=&quot;view&quot;, aliases=&quot;v&quot;, description=&quot;View details for 'stats', 'equipped' or 'backpack'&quot;, debug=false)
    public void command_v(String arg) {
<span class="nc" id="L194">        arg = arg.trim();</span>
<span class="nc bnc" id="L195" title="All 4 branches missed.">        switch (arg) {</span>
            case &quot;s&quot;:
            case &quot;stats&quot;:
<span class="nc" id="L198">                player.getStats();</span>
<span class="nc" id="L199">                break;</span>
            case &quot;e&quot;:
            case &quot;equipped&quot;:
<span class="nc" id="L202">                player.printEquipment();</span>
<span class="nc" id="L203">                break;</span>
            case &quot;b&quot;:
            case &quot;backpack&quot;:
<span class="nc" id="L206">                player.printStorage();</span>
<span class="nc" id="L207">                break;</span>
            default:
<span class="nc" id="L209">                QueueProvider.offer(&quot;That is not a valid display&quot;);</span>
                break;
        }
<span class="nc" id="L212">    }</span>

    @Command(command=&quot;pick&quot;, aliases=&quot;p&quot;, description=&quot;Pick up an item&quot;, debug=false)
    public void command_p(String arg) {
<span class="nc" id="L216">        player.pickUpItem(arg.trim());</span>
<span class="nc" id="L217">    }</span>

    @Command(command=&quot;drop&quot;, aliases=&quot;d&quot;, description=&quot;Drop an item&quot;, debug=false)
    public void command_d(String arg) {
<span class="nc" id="L221">        player.dropItem(arg.trim());</span>
<span class="nc" id="L222">    }</span>

    @Command(command=&quot;attack&quot;, aliases=&quot;a&quot;, description=&quot;Attacks an entity&quot;, debug=false)
    public void command_a(String arg) throws DeathException {
<span class="nc" id="L226">       player.attack(arg.trim());</span>
<span class="nc" id="L227">    }</span>

    @Command(command=&quot;lookaround&quot;, aliases=&quot;la&quot;, description=&quot;Displays the description of the room you are in.&quot;, debug=false)
    public void command_la() {
<span class="nc" id="L231">       player.getLocation().print(); </span>
<span class="nc" id="L232">    }</span>

    // Debug methods here

    @Command(command=&quot;attack&quot;, aliases=&quot;&quot;, description=&quot;Adjusts the damage level the player has&quot;, debug=true)
    public void command_attack(String arg) {
<span class="nc" id="L238">        double damage = Double.parseDouble(arg);</span>
<span class="nc" id="L239">        player.setDamage(damage);</span>
<span class="nc" id="L240">    }</span>

    @Command(command=&quot;maxhealth&quot;, aliases=&quot;&quot;, description=&quot;Adjusts the maximum health of the player&quot;, debug=true)
    public void command_maxhealth(String arg) {
<span class="nc" id="L244">        int healthMax = Integer.parseInt(arg);</span>
<span class="nc bnc" id="L245" title="All 2 branches missed.">        if (healthMax &gt; 0) {</span>
<span class="nc" id="L246">            player.setHealthMax(healthMax);</span>
        } else {
<span class="nc" id="L248">            QueueProvider.offer(&quot;Maximum health must be possitive&quot;);</span>
        }
<span class="nc" id="L250">    }</span>

    @Command(command=&quot;health&quot;, aliases=&quot;&quot;, description=&quot;Adjusts the amount of gold the player has&quot;, debug=true)
    public void command_health(String arg) {
<span class="nc" id="L254">        int health = Integer.parseInt(arg);</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">        if (health &gt; 0) {</span>
<span class="nc" id="L256">            player.setHealth(health);</span>
        } else {
<span class="nc" id="L258">            QueueProvider.offer(&quot;Health must be possitive&quot;);</span>
        }
<span class="nc" id="L260">    }</span>

    @Command(command=&quot;armour&quot;, aliases=&quot;&quot;, description=&quot;Adjusts the amount of armour the player has&quot;, debug=true)
    public void command_armour(String arg) {
<span class="nc" id="L264">        int armour = Integer.parseInt(arg);</span>
<span class="nc" id="L265">        player.setArmour(armour);</span>
<span class="nc" id="L266">    }</span>

    @Command(command=&quot;level&quot;, aliases=&quot;&quot;, description=&quot;Adjusts the level of the player&quot;, debug=true)
    public void command_level(String arg) {
<span class="nc" id="L270">        int level = Integer.parseInt(arg);</span>
<span class="nc" id="L271">        player.setLevel(level);</span>
<span class="nc" id="L272">    }</span>

    @Command(command=&quot;gold&quot;, aliases=&quot;&quot;, description=&quot;Adjusts the amount of gold the player has&quot;, debug=true)
    public void command_gold(String arg) {
<span class="nc" id="L276">        int gold = Integer.parseInt(arg);</span>
<span class="nc" id="L277">        player.setGold(gold);</span>
<span class="nc" id="L278">    }</span>

    @Command(command=&quot;teleport&quot;, aliases=&quot;&quot;, description=&quot;Moves the player to specified coordinates&quot;, debug=true)
    public void command_teleport(String arg) {
<span class="nc" id="L282">        LocationRepository locationRepo = GameBeans.getLocationRepository(player.getName());</span>
<span class="nc" id="L283">        ILocation newLocation = locationRepo.getLocation(new Coordinate(arg));</span>
<span class="nc" id="L284">        ILocation oldLocation = player.getLocation();</span>
        try {
<span class="nc" id="L286">            player.setLocation(newLocation);</span>
<span class="nc" id="L287">            player.getLocation().print();</span>
<span class="nc" id="L288">        } catch (NullPointerException e) {</span>
<span class="nc" id="L289">            player.setLocation(oldLocation);</span>
<span class="nc" id="L290">            QueueProvider.offer(&quot;There is no such location&quot;);</span>
<span class="nc" id="L291">        }</span>
<span class="nc" id="L292">    }</span>

    @Command(command=&quot;backpack&quot;, aliases=&quot;&quot;, description=&quot;Opens the backpack debug menu.&quot;, debug=true)
    public void command_backpack(String arg) {
<span class="nc" id="L296">        new BackpackDebugPrompt(player);</span>
<span class="nc" id="L297">    }</span>
    
    @Command(command=&quot;talk&quot;, aliases=&quot;t&quot;, description=&quot;Talks to a character.&quot;, debug=false)
    public void command_talk(String arg) throws DeathException {
<span class="nc" id="L301">        ConversationManager cm = new ConversationManager();</span>
<span class="nc" id="L302">        List&lt;NPC&gt; npcs = player.getLocation().getNpcs();</span>
<span class="nc" id="L303">        NPC npc = null;</span>
<span class="nc bnc" id="L304" title="All 2 branches missed.">        for (NPC i : npcs) {</span>
<span class="nc bnc" id="L305" title="All 2 branches missed.">            if (i.getName().equalsIgnoreCase(arg)) {</span>
<span class="nc" id="L306">                npc = i;</span>
            }
<span class="nc" id="L308">        }</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">        if (npc != null) {</span>
<span class="nc" id="L310">            cm.startConversation(npc, player);</span>
        } else {
<span class="nc" id="L312">            QueueProvider.offer(&quot;Unable to talk to &quot; + arg);</span>
        }
<span class="nc" id="L314">    }</span>

    private void addItemToLocation() {
<span class="nc" id="L317">        ItemRepository itemRepo = GameBeans.getItemRepository();</span>
<span class="nc bnc" id="L318" title="All 2 branches missed.">        if (player.getHealth() &lt; player.getHealthMax()/3) {</span>
<span class="nc" id="L319">            player.getLocation().addItem(itemRepo.getRandomFood(player.getLevel()));</span>
        } else {
<span class="nc" id="L321">            Random rand = new Random();</span>
<span class="nc" id="L322">            int startIndex = rand.nextInt(3);</span>
<span class="nc bnc" id="L323" title="All 5 branches missed.">            switch (startIndex) {</span>
                case 0:
<span class="nc" id="L325">                    player.getLocation().addItem(itemRepo.getRandomWeapon(player.getLevel()));</span>
<span class="nc" id="L326">                    break;</span>
                case 1:
<span class="nc" id="L328">                    player.getLocation().addItem(itemRepo.getRandomFood(player.getLevel()));</span>
<span class="nc" id="L329">                    break;</span>
                case 2:
<span class="nc" id="L331">                    player.getLocation().addItem(itemRepo.getRandomArmour(player.getLevel()));</span>
<span class="nc" id="L332">                    break;</span>
                case 3:
<span class="nc" id="L334">                    player.getLocation().addItem(itemRepo.getRandomPotion(player.getLevel()));</span>
                    break;
             }
        }
<span class="nc" id="L338">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>