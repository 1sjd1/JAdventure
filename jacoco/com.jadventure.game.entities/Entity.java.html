<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Entity.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Java Text Adventure</a> &gt; <a href="index.source.html" class="el_package">com.jadventure.game.entities</a> &gt; <span class="el_source">Entity.java</span></div><h1>Entity.java</h1><pre class="source lang-java linenums">package com.jadventure.game.entities;

import java.util.Collections;
import java.util.HashMap;
import java.util.Map;

import com.jadventure.game.GameBeans;
import com.jadventure.game.QueueProvider;
import com.jadventure.game.items.Item;
import com.jadventure.game.items.ItemStack;
import com.jadventure.game.items.Storage;
import com.jadventure.game.repository.ItemRepository;

/**
 * superclass for all entities (includes player, monsters...)
 */
public abstract class Entity {
    // @Resource
<span class="fc" id="L19">    protected ItemRepository itemRepo = GameBeans.getItemRepository();</span>
    
    // All entities can attack, have health, have names
    private int healthMax;
    private int health;
    private String name;
    private String intro;
    private int level;
    // Statistics
    private int strength;
    private int intelligence;
    private int dexterity;
    private int luck;
    private int stealth;
    private int gold;
<span class="fc" id="L34">    private double damage = 30;</span>
<span class="fc" id="L35">    private double critChance = 0.0;</span>
    private int armour;
<span class="fc" id="L37">    private String weapon = &quot;empty&quot;;</span>
    private Map&lt;EquipmentLocation, Item&gt; equipment;
    protected Storage storage;

    public Entity() {
<span class="fc" id="L42">    	this(100, 100, &quot;default&quot;, 0, null, new HashMap&lt;EquipmentLocation, Item&gt;());</span>
<span class="fc" id="L43">    }</span>
    
<span class="fc" id="L45">    public Entity(int healthMax, int health, String name, int gold, Storage storage, Map&lt;EquipmentLocation, Item&gt; equipment) {</span>
<span class="fc" id="L46">        this.healthMax = healthMax;</span>
<span class="fc" id="L47">        this.health = health;</span>
<span class="fc" id="L48">        this.name = name;</span>
<span class="fc" id="L49">        this.gold = gold;</span>
<span class="pc bpc" id="L50" title="1 of 2 branches missed.">        if (storage != null) {</span>
<span class="nc" id="L51">        	this.storage = storage;</span>
        }
        else {
<span class="fc" id="L54">        	this.storage = new Storage(300);</span>
        }
<span class="fc" id="L56">	    this.equipment = equipment;</span>
<span class="fc" id="L57">    }</span>
    

    public int getHealth() {
<span class="fc" id="L61">        return this.health;</span>
    }

    public void setHealth(int health) {
<span class="fc" id="L65">        this.health = health;</span>
<span class="pc bpc" id="L66" title="1 of 2 branches missed.">        if (health &gt; healthMax) {</span>
<span class="nc" id="L67">            health = healthMax;</span>
        }
<span class="fc" id="L69">    }</span>

    public int getGold() {
<span class="fc" id="L72">        return gold;</span>
    }

    public void setGold(int gold) {
<span class="fc" id="L76">        this.gold = gold;</span>
<span class="fc" id="L77">    }</span>

    public double getDamage() {
<span class="fc" id="L80">        return damage;</span>
    }

    public void setDamage(double damage) {
<span class="fc" id="L84">        this.damage = damage;</span>
<span class="fc" id="L85">    }</span>

    public double getCritChance() {
<span class="nc" id="L88">        return critChance;</span>
    }

    public void setCritChance(double critChance) {
<span class="nc" id="L92">        this.critChance = critChance;</span>
<span class="nc" id="L93">    }</span>

    public int getArmour() {
<span class="fc" id="L96">        return armour;</span>
    }

    public void setArmour(int armour) {
<span class="fc" id="L100">        this.armour = armour;</span>
<span class="fc" id="L101">    }</span>

    public int getHealthMax() {
<span class="fc" id="L104">        return healthMax;</span>
    }

    public void setHealthMax(int healthMax) {
<span class="fc" id="L108">        this.healthMax = healthMax;</span>
<span class="fc bfc" id="L109" title="All 2 branches covered.">        if (health &gt; healthMax) {</span>
<span class="fc" id="L110">            health = healthMax;</span>
        }
<span class="fc" id="L112">    }</span>

    public String getName() {
<span class="fc" id="L115">        return this.name;</span>
    }

    public void setName(String name) {
<span class="fc" id="L119">        this.name = name;</span>
<span class="fc" id="L120">    }</span>
     
    public void setIntro(String intro) {
<span class="fc" id="L123">        this.intro = intro;</span>
<span class="fc" id="L124">    }</span>

    public String getIntro() {
<span class="nc" id="L127">        return this.intro;</span>
    }
    
    public int getLevel() {
<span class="fc" id="L131">        return level;</span>
    }

    public void setLevel(int level) {
<span class="fc" id="L135">        this.level = level;</span>
<span class="fc" id="L136">    }</span>

    public Map&lt;EquipmentLocation, Item&gt; getEquipment() {
<span class="fc" id="L139">        return Collections.unmodifiableMap(equipment);</span>
    }

    public int getStrength() {
<span class="fc" id="L143">        return strength;</span>
    }
    
    public void setStrength(int strength) {
<span class="fc" id="L147">        this.strength = strength;</span>
<span class="fc" id="L148">    }</span>

    public int getIntelligence() {
<span class="fc" id="L151">        return intelligence;</span>
    }

    public void setIntelligence(int intelligence) {
<span class="fc" id="L155">        this.intelligence = intelligence;</span>
<span class="fc" id="L156">    }</span>
 
    public int getDexterity() {
<span class="fc" id="L159">        return dexterity;</span>
    }

    public void setDexterity(int dexterity) {
<span class="fc" id="L163">        this.dexterity = dexterity;</span>
<span class="fc" id="L164">    }</span>

    public int getLuck() {
<span class="fc" id="L167">        return luck;</span>
    }

    public void setLuck(int luck) {
<span class="fc" id="L171">        this.luck = luck;</span>
<span class="fc" id="L172">    }</span>

    public int getStealth() {
<span class="fc" id="L175">        return stealth;</span>
    }

    public void setStealth(int stealth) {
<span class="fc" id="L179">        this.stealth = stealth;</span>
<span class="fc" id="L180">    }</span>

    public String getWeapon() {
<span class="fc" id="L183">        return weapon;</span>
    }

    public Map&lt;String, String&gt; equipItem(EquipmentLocation place, Item item) {
<span class="fc" id="L187">        double oldDamage = this.damage;</span>
<span class="fc" id="L188">        Item empty = itemRepo.getItem(&quot;empty&quot;);</span>
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">        if (place == null) {</span>
<span class="nc" id="L190">            place = item.getPosition();</span>
        }
<span class="pc bpc" id="L192" title="1 of 2 branches missed.">        if (equipment.get(place) != null) {</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">            if (!empty.equals(equipment.get(place))) {</span>
<span class="nc" id="L194">                unequipItem(equipment.get(place));</span>
            }
        }
<span class="fc bfc" id="L197" title="All 2 branches covered.">        if (place == EquipmentLocation.BOTH_HANDS) {</span>
<span class="fc" id="L198">            Item leftHand = equipment.get(EquipmentLocation.LEFT_HAND);</span>
<span class="fc" id="L199">            Item rightHand = equipment.get(EquipmentLocation.RIGHT_HAND);</span>
<span class="pc bpc" id="L200" title="3 of 4 branches missed.">            if (leftHand != null &amp;&amp; !empty.equals(leftHand)) {</span>
<span class="nc" id="L201">                unequipItem(leftHand);</span>
            }
<span class="pc bpc" id="L203" title="3 of 4 branches missed.">            if (rightHand != null &amp;&amp; !empty.equals(rightHand)) {</span>
<span class="nc" id="L204">                unequipItem(rightHand);</span>
            }
        }
<span class="fc" id="L207">        Item bothHands = equipment.get(EquipmentLocation.BOTH_HANDS);</span>
<span class="pc bpc" id="L208" title="1 of 4 branches missed.">        if (bothHands != null &amp;&amp; !empty.equals(bothHands)) {</span>
<span class="fc" id="L209">            unequipItem(bothHands);</span>
        }
<span class="fc" id="L211">        equipment.put(place, item);</span>
<span class="fc" id="L212">        removeItemFromStorage(item);</span>
<span class="fc" id="L213">        Map&lt;String, String&gt; result = new HashMap&lt;String, String&gt;();</span>
<span class="pc bpc" id="L214" title="3 of 5 branches missed.">        switch (item.getId().charAt(0)) {</span>
        case 'w': {
<span class="fc" id="L216">            this.weapon = item.getId();</span>
<span class="fc" id="L217">            this.damage += item.getProperty(&quot;damage&quot;);</span>
<span class="fc" id="L218">            double diffDamage = this.damage - oldDamage;</span>
<span class="fc" id="L219">            result.put(&quot;damage&quot;, String.valueOf(diffDamage));</span>
<span class="fc" id="L220">            break;</span>
        }
        case 'a': {
<span class="nc" id="L223">            this.armour += item.getProperty(&quot;armour&quot;);</span>
<span class="nc" id="L224">            result.put(&quot;armour&quot;, String.valueOf(item.getProperty(&quot;armour&quot;)));</span>
<span class="nc" id="L225">            break;</span>
        }
        case 'p': {
<span class="nc bnc" id="L228" title="All 2 branches missed.">            if (item.containsProperty(&quot;healthMax&quot;)) {</span>
<span class="nc" id="L229">                int healthOld = this.getHealth();</span>
<span class="nc" id="L230">                this.healthMax += item.getProperty(&quot;healthMax&quot;);</span>
<span class="nc" id="L231">                this.health += item.getProperty(&quot;health&quot;);</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">                this.health = (this.health &gt; this.healthMax) ? this.healthMax : this.health;</span>
<span class="nc" id="L233">                int healthNew = this.health;</span>
<span class="nc" id="L234">                unequipItem(item); // One use only</span>
<span class="nc" id="L235">                removeItemFromStorage(item);</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">                if (healthNew != healthOld) {</span>
<span class="nc" id="L237">                    result.put(&quot;health&quot;, String.valueOf(health - healthOld));</span>
                } else {
<span class="nc" id="L239">                    result.put(&quot;health&quot;, String.valueOf(item.getProperty(&quot;healthMax&quot;)));</span>
                }
<span class="nc" id="L241">            }</span>
            break;
        }
        case 'f': {
<span class="nc" id="L245">            int healthOld = this.getHealth();</span>
<span class="nc" id="L246">            this.health += item.getProperty(&quot;health&quot;);</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">            this.health = (this.health &gt; this.healthMax) ? this.healthMax</span>
                    : this.health;
<span class="nc" id="L249">            unequipItem(item); // One use only</span>
<span class="nc" id="L250">            removeItemFromStorage(item);</span>
<span class="nc" id="L251">            result.put(&quot;health&quot;, String.valueOf(health - healthOld));</span>
<span class="nc" id="L252">            break;</span>
        }
        }
<span class="fc" id="L255">        return result;</span>
    }

    public Map&lt;String, String&gt; unequipItem(Item item) {
<span class="fc" id="L259">        double oldDamage = damage;</span>
<span class="fc bfc" id="L260" title="All 2 branches covered.">        for (EquipmentLocation key : equipment.keySet()) {</span>
<span class="pc bpc" id="L261" title="1 of 2 branches missed.">            if (equipment.get(key).equals(item)) {</span>
<span class="fc" id="L262">                equipment.put(key, null);</span>
            }
<span class="fc" id="L264">        }</span>
<span class="fc" id="L265">        addItemToStorage(item);</span>
<span class="fc" id="L266">        Map&lt;String, String&gt; result = new HashMap&lt;String, String&gt;();</span>
<span class="pc bpc" id="L267" title="1 of 2 branches missed.">        if (item.containsProperty(&quot;damage&quot;)) {</span>
<span class="fc" id="L268">            weapon = &quot;hands&quot;;</span>
<span class="fc" id="L269">            damage -= item.getProperty(&quot;damage&quot;);</span>
<span class="fc" id="L270">            double diffDamage = damage - oldDamage;</span>
<span class="fc" id="L271">            result.put(&quot;damage&quot;, String.valueOf(diffDamage));</span>
        }
<span class="fc" id="L273">        return result;</span>
    }

    public void printEquipment() {
<span class="nc" id="L277">        QueueProvider.offer(&quot;\n------------------------------------------------------------&quot;);</span>
<span class="nc" id="L278">        QueueProvider.offer(&quot;Equipped Items:&quot;);</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">        if (equipment.keySet().size() == 0) {</span>
<span class="nc" id="L280">            QueueProvider.offer(&quot;--Empty--&quot;);</span>
        } else {
<span class="nc bnc" id="L282" title="All 2 branches missed.">            for (Map.Entry&lt;EquipmentLocation, Item&gt; item : equipment.entrySet()) {</span>
<span class="nc bnc" id="L283" title="All 4 branches missed.">                if (item.getKey() != null &amp;&amp; item.getValue() != null) {</span>
<span class="nc" id="L284">                    QueueProvider.offer(item.getKey() + &quot; - &quot; + item.getValue().getName());</span>
                }
<span class="nc" id="L286">            }</span>
        }
<span class="nc" id="L288">        QueueProvider.offer(&quot;------------------------------------------------------------&quot;); </span>
<span class="nc" id="L289">    }</span>

    public Storage getStorage() {
<span class="fc" id="L292">        return storage;</span>
    }

    public void setStorage(Storage storage) {
<span class="fc" id="L296">        this.storage = storage;</span>
<span class="fc" id="L297">    }</span>

    public void printStorage() {
<span class="nc" id="L300">       storage.display();</span>
<span class="nc" id="L301">    } </span>
    
    public void addItemToStorage(Item item) {
<span class="pc bpc" id="L304" title="2 of 4 branches missed.">        if (!item.equals(itemRepo.getItem(&quot;empty&quot;)) &amp;&amp; !item.equals(itemRepo.getItem(&quot;hands&quot;))) {</span>
<span class="fc" id="L305">            storage.addItem(new ItemStack(1, item));</span>
        }
<span class="fc" id="L307">    }</span>

    public void removeItemFromStorage(Item item) {
<span class="fc bfc" id="L310" title="All 2 branches covered.">        if (!item.equals(itemRepo.getItem(&quot;empty&quot;))) {</span>
<span class="fc" id="L311">            storage.removeItem(new ItemStack(1, item)); </span>
        }
<span class="fc" id="L313">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span></div></body></html>